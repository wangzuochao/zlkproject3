<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zlk.zlkproject.community.mapper.ArticleMapper">
    <resultMap id="ArticleResultMap" type="com.zlk.zlkproject.community.entity.Article" >
        <id column="article_id" property="articleId" jdbcType="INTEGER" />
        <result column="user_id" property="userId" jdbcType="INTEGER" />
        <result column="program_id" property="programId" jdbcType="INTEGER" />
        <result column="article_title" property="articleTitle" jdbcType="VARCHAR" />
        <result column="article_content_markdown" property="articleContentMarkdown" jdbcType="LONGVARCHAR" />
        <result column="article_content_html" property="articleContentHtml" jdbcType="LONGVARCHAR" />
        <result column="article_date" property="articleDate" jdbcType="TIMESTAMP" />
        <result column="like_num" property="likeNum" jdbcType="INTEGER" />
        <result column="stamp_num" property="stampNum" jdbcType="INTEGER" />
        <result column="article_report_num" property="articleReportNum" jdbcType="INTEGER" />
        <result column="article_image" property="articleImage" jdbcType="VARCHAR" />
        <result column="pageviews" property="pageviews" jdbcType="INTEGER" />
        <result column="top_status" property="topStatus" jdbcType="INTEGER" />
        <association property="articleProgram" javaType="com.zlk.zlkproject.community.entity.ArticleProgram">
            <id column="program_id" property="programId" jdbcType="VARCHAR" />
            <result column="program_name" property="programName" jdbcType="VARCHAR" />
        </association>
        <association property="user" javaType="com.zlk.zlkproject.user.entity.User">
            <id column="id" property="userId" jdbcType="INTEGER" />
            <result column="username" property="userName" jdbcType="VARCHAR" />
        </association>
    </resultMap>
    <!--流加载全部文章-->
    <select id="findAllLayui" resultMap="ArticleResultMap">
        SELECT
        article.*,article_program.*
        FROM
        article,article_program
        where
        article.program_id = article_program.program_id
        ORDER BY `article`.`top_status` DESC, `article`.`pageviews` DESC
        limit #{pageIndex},#{pageSize}
    </select>
    <!--获取文章总数-->
    <select id="countArticle" resultType="Integer">
        SELECT COUNT(*) FROM article
    </select>
    <!--查询单篇文章的内容 包含用户信息和栏目信息-->
    <select id="getArticleById" resultMap="ArticleResultMap">
        SELECT
        article.*,article_program.*,user.*
        FROM
        article,article_program,user
        where
        article_id = #{articleId} and article.program_id = article_program.program_id and article.user_id = user.id
    </select>
</mapper>